# 第07章_单行函数



## 1. 函数的理解

### 1.1 什么是函数

把我们经常使用的代码封装起来，需要的时候直接调用即可

这样既`提高了代码效率`，又`提高了可维护性`

在 SQL 中我们也可以使用函数对检索出来的数据进行函数操作

使用这些函数，可以极大地`提高用户对数据库的管理效率`。

---

![1554979529525](http://fgcy-pic.zhamao.ml/1554979529525.png)

----



从函数定义的角度出发，我们可以将函数分成`内置函数`和`自定义函数`

在 SQL 语言中，同样也包括了内置函数和自定义函数。内置函数是系统内置的通用函数，而自定义函数是我们根据自己的需要编写的

本章及下一章讲解的是 SQL 的内置函数。





### 1.2 不同DBMS函数的差异

1、我们在使用 SQL 语言的时候，不是直接和这门语言打交道，而是通过它使用不同的数据库软件，即 DBMS

​	因为SQL语言是运行在DBMS中的，然后由DBMS对数据库文件进行操作；



2、**DBMS 之间的差异性很大，远大于同一个语言不同版本之间的差异。**

实际上，只有很少的函数是被 DBMS 同时支持的

比如，大多数 DBMS 使用（||）或者（+）来做拼接符，而在 MySQL 中的字符串拼接函数为concat()



3、大部分 DBMS 会有自己特定的函数，这就意味着**采用 SQL 函数的代码可移植性是很差的**，因此在使用函数的时候需要特别注意。





### 1.3 MySQL的内置函数及分类



MySQL提供的内置函数从`实现的功能角度`可以分为数值函数、字符串函数、日期和时间函数、流程控制函数、加密与解密函数、获取MySQL信息函数、聚合函数等



这里，我将这些丰富的内置函数再分为两类：`单行函数`、`聚合函数（或分组函数）`



**两种SQL函数**

---

![1555433204337](http://fgcy-pic.zhamao.ml/1555433204337.png)

---



**单行函数**

- 接受参数返回一个结果
- **只对一行进行变换**
- **每行返回一个结果**
- 可以嵌套
- 参数可以是一个字段或一个值

一进一出





## 2. 数值函数

### 2.1 基本函数

| 函数                | 用法                                                         |
| ------------------- | ------------------------------------------------------------ |
| ABS(x)              | 返回x的绝对值                                                |
| SIGN(X)             | 返回X的符号。正数返回1，负数返回-1，0返回0                   |
| PI()                | 返回圆周率的值                                               |
| CEIL(x)，CEILING(x) | 返回大于或等于某个值的最小整数                               |
| FLOOR(x)            | 返回小于或等于某个值的最大整数                               |
| LEAST(e1,e2,e3…)    | 返回列表中的最小值                                           |
| GREATEST(e1,e2,e3…) | 返回列表中的最大值                                           |
| MOD(x,y)            | 返回X除以Y后的余数                                           |
| RAND()              | 返回0~1的随机值                                              |
| RAND(x)             | 返回0~1的随机值，其中x的值用作种子值，相同的X值会产生相同的随机数 |
| ROUND(x)            | 返回一个对x的值进行四舍五入后，最接近于X的整数               |
| ROUND(x,y)          | 返回一个对x的值进行四舍五入后最接近X的值，并保留到小数点后面Y位 |
| TRUNCATE(x,y)       | 返回数字x截断为y位小数的结果                                 |
| SQRT(x)             | 返回x的平方根。当X的值为负数时，返回NULL                     |



举例：

**绝对值、取符号、获取圆周率的值、向下取整，向上取整、求模**

```mysql
SELECT ABS(-123),ABS(32),SIGN(-23),SIGN(43),PI(),CEIL(32.32),CEILING(-43.23),FLOOR(32.32),
FLOOR(-43.23),MOD(12,5)
FROM DUAL;
```

---

![image-20211025162304844](http://fgcy-pic.zhamao.ml/image-20211025162304844.png)

---



**0~1的随机函数，带种子的随机值函数**

```mysql
SELECT RAND(),RAND(),RAND(10),RAND(10),RAND(-1),RAND(-1)
FROM DUAL;
```

---

![image-20211025162538958](http://fgcy-pic.zhamao.ml/image-20211025162538958.png)

---





**一个参数的四舍五入函数，两个参数的四舍五入函数，数值截断函数**

```mysql

SELECT ROUND(12.33),ROUND(12.343,2),ROUND(12.324,-1),TRUNCATE(12.66,1),TRUNCATE(12.66,-1)
FROM DUAL;
```

-- ROUND双参数函数，第二位参数为 0保留个位，-1保留十位，1保留小数点后第一位
-- ROUND(x);保留整数





---

![image-20211025162730421](http://fgcy-pic.zhamao.ml/image-20211025162730421.png)

---



**截断操作**

~~~mysql
SELECT TRUNCATE(123.456,0),TRUNCATE(123.496,1),TRUNCATE(129.45,-1)
FROM DUAL;
+---------------------+---------------------+---------------------+
| TRUNCATE(123.456,0) | TRUNCATE(123.496,1) | TRUNCATE(129.45,-1) |
+---------------------+---------------------+---------------------+
|                 123 |               123.4 |                 120 |
+---------------------+---------------------+---------------------+
~~~

---TRUNCATE:双参数函数：第二位参数为 0保留个位，-1保留十位，1保留小数点后第一位



**单行函数可以嵌套**

~~~mysql
SELECT TRUNCATE(ROUND(123.456,2),0)
FROM DUAL;
-- 四舍五入 123.46
-- 保留整数
+------------------------------+
| TRUNCATE(ROUND(123.456,2),0) |
+------------------------------+
|                          123 |
+------------------------------+
~~~



### 2.2 角度与弧度互换函数(了解)

| 函数       | 用法                                  |
| ---------- | ------------------------------------- |
| RADIANS(x) | 将角度转化为弧度，其中，参数x为角度值 |
| DEGREES(x) | 将弧度转化为角度，其中，参数x为弧度值 |

```mysql
SELECT RADIANS(30),RADIANS(60),RADIANS(90),DEGREES(2*PI()),DEGREES(RADIANS(90))
FROM DUAL;
```



### 2.3 三角函数(了解)

| 函数       | 用法                                                         |
| ---------- | ------------------------------------------------------------ |
| SIN(x)     | 返回x的正弦值，其中，参数x为弧度值                           |
| ASIN(x)    | 返回x的反正弦值，即获取正弦为x的值。如果x的值不在-1到1之间，则返回NULL |
| COS(x)     | 返回x的余弦值，其中，参数x为弧度值                           |
| ACOS(x)    | 返回x的反余弦值，即获取余弦为x的值。如果x的值不在-1到1之间，则返回NULL |
| TAN(x)     | 返回x的正切值，其中，参数x为弧度值                           |
| ATAN(x)    | 返回x的反正切值，即返回正切值为x的值                         |
| ATAN2(m,n) | 返回两个参数的反正切值                                       |
| COT(x)     | 返回x的余切值，其中，X为弧度值                               |

举例：

ATAN2(M,N)函数返回两个参数的反正切值

与ATAN(X)函数相比，ATAN2(M,N)需要两个参数，例如有两个点point(x1,y1)和point(x2,y2)，使用ATAN(X)函数计算反正切值为ATAN((y2-y1)/(x2-x1))，使用ATAN2(M,N)计算反正切值则为ATAN2(y2-y1,x2-x1)。由使用方式可以看出，当x2-x1等于0时，ATAN(X)函数会报错，而ATAN2(M,N)函数则仍然可以计算



ATAN2(M,N)函数的使用示例如下：

```mysql
SELECT SIN(RADIANS(30)),DEGREES(ASIN(1)),TAN(RADIANS(45)),DEGREES(ATAN(1)),DEGREES(ATAN2(1,1))
FROM DUAL;
```

---

![image-20211025163846974](http://fgcy-pic.zhamao.ml/image-20211025163846974.png)

---



### 2.4 指数与对数(了解)

| 函数                 | 用法                                                 |
| -------------------- | ---------------------------------------------------- |
| POW(x,y)，POWER(X,Y) | 返回x的y次方                                         |
| EXP(X)               | 返回e的X次方，其中e是一个常数，2.718281828459045     |
| LN(X)，LOG(X)        | 返回以e为底的X的对数，当X <= 0 时，返回的结果为NULL  |
| LOG10(X)             | 返回以10为底的X的对数，当X <= 0 时，返回的结果为NULL |
| LOG2(X)              | 返回以2为底的X的对数，当X <= 0 时，返回NULL          |

```mysql
mysql> SELECT POW(2,5),POWER(2,4),EXP(2),LN(10),LOG10(10),LOG2(4)
    -> FROM DUAL;
+----------+------------+------------------+-------------------+-----------+---------+
| POW(2,5) | POWER(2,4) | EXP(2)           | LN(10)            | LOG10(10) | LOG2(4) |
+----------+------------+------------------+-------------------+-----------+---------+
|       32 |         16 | 7.38905609893065 | 2.302585092994046 |         1 |       2 |
+----------+------------+------------------+-------------------+-----------+---------+
1 row in set (0.00 sec)
```





### 2.5 进制间的转换

| 函数          | 用法                     |
| ------------- | ------------------------ |
| BIN(x)        | 返回x的二进制编码        |
| HEX(x)        | 返回x的十六进制编码      |
| OCT(x)        | 返回x的八进制编码        |
| CONV(x,f1,f2) | 返回f1进制数变成f2进制数 |

```mysql
mysql> SELECT BIN(10),HEX(10),OCT(10),CONV(10,2,8)
    -> FROM DUAL;
+---------+---------+---------+--------------+
| BIN(10) | HEX(10) | OCT(10) | CONV(10,2,8) |
+---------+---------+---------+--------------+
| 1010    | A       | 12      | 2            |
+---------+---------+---------+--------------+
1 row in set (0.00 sec)
```





## 3. 字符串函数

| 函数                              | 用法                                                         |
| --------------------------------- | ------------------------------------------------------------ |
| ASCII(S)                          | 返回字符串S中的第一个字符的ASCII码值                         |
| CHAR_LENGTH(s)                    | 返回字符串s的字符数。作用与CHARACTER_LENGTH(s)相同           |
| LENGTH(s)                         | 返回字符串s的字节数，和字符集有关                            |
| CONCAT(s1,s2,......,sn)           | 连接s1,s2,......,sn为一个字符串                              |
| CONCAT_WS(x, s1,s2,......,sn)     | 同CONCAT(s1,s2,...)函数，但是每个字符串之间要加上x           |
| INSERT(str, idx, len, replacestr) | 将字符串str从第idx位置开始，len个字符长的子串替换为字符串replacestr |
| REPLACE(str, a, b)                | 用字符串b替换字符串str中所有出现的字符串a                    |
| UPPER(s) 或 UCASE(s)              | 将字符串s的所有字母转成大写字母                              |
| LOWER(s)  或LCASE(s)              | 将字符串s的所有字母转成小写字母                              |
| LEFT(str,n)                       | 返回字符串str最左边的n个字符                                 |
| RIGHT(str,n)                      | 返回字符串str最右边的n个字符                                 |
| LPAD(str, len, pad)               | 用字符串pad对str最左边进行填充，直到str的长度为len个字符     |
| RPAD(str ,len, pad)               | 用字符串pad对str最右边进行填充，直到str的长度为len个字符     |
| LTRIM(s)                          | 去掉字符串s左侧的空格                                        |
| RTRIM(s)                          | 去掉字符串s右侧的空格                                        |
| TRIM(s)                           | 去掉字符串s开始与结尾的空格                                  |
| TRIM(s1 FROM s)                   | 去掉字符串s开始与结尾的s1                                    |
| TRIM(LEADING s1 FROM s)           | 去掉字符串s开始处的s1                                        |
| TRIM(TRAILING s1 FROM s)          | 去掉字符串s结尾处的s1                                        |
| REPEAT(str, n)                    | 返回str重复n次的结果                                         |
| SPACE(n)                          | 返回n个空格                                                  |
| STRCMP(s1,s2)                     | 比较字符串s1,s2的ASCII码值的大小                             |
| SUBSTR(s,index,len)               | 返回从字符串s的index位置其len个字符，作用与SUBSTRING(s,n,len)、MID(s,n,len)相同 |
| LOCATE(substr,str)                | 返回字符串substr在字符串str中首次出现的位置，作用于POSITION(substr IN str)、INSTR(str,substr)相同。未找到，返回0 |
| ELT(m,s1,s2,…,sn)                 | 返回指定位置的字符串，如果m=1，则返回s1，如果m=2，则返回s2，如果m=n，则返回sn |
| FIELD(s,s1,s2,…,sn)               | 返回字符串s在字符串列表中第一次出现的位置                    |
| FIND_IN_SET(s1,s2)                | 返回字符串s1在字符串s2中出现的位置。其中，字符串s2是一个以逗号分隔的字符串 |
| REVERSE(s)                        | 返回s反转后的字符串                                          |
| NULLIF(value1,value2)             | 比较两个字符串，如果value1与value2相等，则返回NULL，否则返回value1 |

> 注意：MySQL中，字符串的位置是从1开始的







**字符数、字节数、ASCII值**

~~~mysql
-- 返回字符串S中的第一个字符的ASCII码值
SELECT ASCII('Abcdfsf'),CHAR_LENGTH('hello'),CHAR_LENGTH('我们'),
LENGTH('hello'),LENGTH('我们')
FROM DUAL;
+------------------+----------------------+-----------------------+-----------------+------------------+
| ASCII('Abcdfsf') | CHAR_LENGTH('hello') | CHAR_LENGTH('我们')   | LENGTH('hello') | LENGTH('我们')   |
+------------------+----------------------+-----------------------+-----------------+------------------+
|               65 |                    5 |                     2 |               5 |                6 |
+------------------+----------------------+-----------------------+-----------------+------------------+
~~~





**字符串连接 CONCAT**

**1、CONCAT**

~~~mysql
--  自连接 + 内连接
SELECT CONCAT(emp.last_name,' worked for ',mgr.last_name) "details"
FROM employees emp JOIN employees mgr
WHERE emp.`manager_id` = mgr.employee_id;
+--------------------------------+
| details                        |
+--------------------------------+
| Kochhar worked for King        |
| De Haan worked for King        |
| Hunold worked for De Haan      |
| Ernst worked for Hunold        |
+--------------------------------+
~~~

**2、CONCAT_WS**

~~~MYSQL
SELECT CONCAT_WS('-','hello','world','hello','beijing')
FROM DUAL;
+--------------------------------------------------+
| CONCAT_WS('-','hello','world','hello','beijing') |
+--------------------------------------------------+
| hello-world-hello-beijing                        |
+--------------------------------------------------+
~~~





**两个替换函数**

~~~MYSQL
#字符串的索引是从1开始的！
-- 这里的意思是将 ell 换成 aaaaa
SELECT INSERT('helloworld',2,3,'aaaaa'),REPLACE('hello','lol','mmm')
FROM DUAL;
+----------------------------------+------------------------------+
| INSERT('helloworld',2,3,'aaaaa') | REPLACE('hello','llo','mmm') |
+----------------------------------+------------------------------+
| haaaaaoworld                     | hemmm                        |
+----------------------------------+------------------------------+
~~~

注意：

字符串的索引是从1开始的

REPLACE（）：当第一个参数中没有第2个参数的值，则替换失败，但不会报错



**大写、小写**

~~~MYSQL
SELECT UPPER('HelLo'),LOWER('HelLo')
FROM DUAL;
+----------------+----------------+
| UPPER('HelLo') | LOWER('HelLo') |
+----------------+----------------+
| HELLO          | hello          |
+----------------+----------------+

-- MYSQL对SQL的支持不是特别高，字符串内不区分大小写
SELECT last_name,salary
FROM employees
WHERE LOWER(last_name) = 'King';
+-----------+----------+
| last_name | salary   |
+-----------+----------+
| King      | 24000.00 |
| King      | 10000.00 |
+-----------+----------+
~~~



**截取字符串（左右两边）**

~~~MYSQL
SELECT LEFT('hello',2),RIGHT('hello',3),RIGHT('hello',13)
FROM DUAL;
+-----------------+------------------+-------------------+
| LEFT('hello',2) | RIGHT('hello',3) | RIGHT('hello',13) |
+-----------------+------------------+-------------------+
| he              | llo              | hello             |
+-----------------+------------------+-------------------+
~~~



**实现右对齐效果 、实现左对齐效果**

~~~MYSQL
-- 将工资转为字符串，一共占十位，不足十位在前面补空格
-- 在左边补零，右对齐

SELECT employee_id,last_name,LPAD(salary,10,' ')
FROM employees;

+-------------+-------------+---------------------+
| employee_id | last_name   | LPAD(salary,10,' ') |
+-------------+-------------+---------------------+
|         100 | King        |   24000.00          |
|         102 | De Haan     |   17000.00          |
|         104 | Ernst       |    6000.00          |
+-------------------------------------------------+
~~~



**去除字符（空格）**

~~~mysql
-- 去除左边的空格
SELECT CONCAT('---',LTRIM('    h  el  lo   '),'***'),
-- 只是去除左边符合的oo，右边的o不管
TRIM('oo' FROM 'ooheollo')
FROM DUAL;
+-----------------------------------------------+----------------------------+
| CONCAT('---',LTRIM('    h  el  lo   '),'***') | TRIM('oo' FROM 'ooheollo') |
+-----------------------------------------------+----------------------------+
| ---h  el  lo   ***                            | heollo                     |
+-----------------------------------------------+----------------------------+
~~~



**重复、空格、比较大小**

~~~mysql
SELECT REPEAT('hello',4),LENGTH(SPACE(5)),STRCMP('abc','abe')
FROM DUAL;
+----------------------+------------------+---------------------+
| REPEAT('hello',4)    | LENGTH(SPACE(5)) | STRCMP('abc','abe') |
+----------------------+------------------+---------------------+
| hellohellohellohello |                5 |                  -1 |#负数表示后面的大
+----------------------+------------------+---------------------+
~~~



**截取字符串**

~~~mysql
-- SUBSTR(s,index,len)返回从字符串s的index位置其len个字符，作用与SUBSTRING(s,n,len)、MID(s,n,len)相同
-- 返回字符串substr在字符串str中首次出现的位置
SELECT SUBSTR('hello',2,2),LOCATE('lll','hello')
FROM DUAL;
+---------------------+-----------------------+
| SUBSTR('hello',2,2) | LOCATE('lll','hello') |
+---------------------+-----------------------+
| el                  |                     0 |
+---------------------+-----------------------+

select substring('helloworld',2,2);
+-----------------------------+
| substring('helloworld',2,2) |
+-----------------------------+
| el                          |
+-----------------------------+

select mid('helloworld',2,2);
+-----------------------+
| mid('helloworld',2,2) |
+-----------------------+
| el                    |
+-----------------------+
~~~



**字符串查找**

~~~mysql
--  ELT(m,s1,s2,…,sn)   返回指定位置的字符串，如果m=1，则返回s1，如果m=2，则返回s2，如果m=n，则返回sn 相当于charAt()
-- FIELD(s,s1,s2,…,sn) 返回字符串s在字符串列表中第一次出现的位置 indexOf()                  
--  FIND_IN_SET(s1,s2)  返回字符串s1在字符串s2中出现的位置。其中，字符串s2是一个以逗号分隔的字符串    indexOf（）                                  
SELECT ELT(2,'a','b','c','d'),FIELD('mm','gg','jj','mm','dd','mm'),
FIND_IN_SET('mm','gg,mm,jj,dd,mm,gg')
FROM DUAL;
+------------------------+--------------------------------------+---------------------------------------+
| ELT(2,'a','b','c','d') | FIELD('mm','gg','jj','mm','dd','mm') | FIND_IN_SET('mm','gg,mm,jj,dd,mm,gg') |
+------------------------+--------------------------------------+---------------------------------------+
| b                      |                                    3 |                                     2 |
+------------------------+--------------------------------------+---------------------------------------+
~~~



**字符串比较 相同为null**

~~~mysql
-- NULLIF(value1,value2)比较两个字符串，如果value1与value2相等，则返回NULL，否则返回value1
SELECT employee_id,NULLIF(LENGTH(first_name),LENGTH(last_name)) "compare"
FROM employees;
+-------------+---------+
| employee_id | compare+ |
+-------------+---------+
|         100 |       6 |
|         101 |       5 |
|         102 |       3 |
|         103 |       9 |
|         104 |    NULL |
+-----------------------+
~~~







举例：

```mysql
mysql> SELECT FIELD('mm','hello','msm','amma'),FIND_IN_SET('mm','hello,mm,amma')
    -> FROM DUAL;
+----------------------------------+-----------------------------------+
| FIELD('mm','hello','msm','amma') | FIND_IN_SET('mm','hello,mm,amma') |
+----------------------------------+-----------------------------------+
|                                0 |                                 2 |
+----------------------------------+-----------------------------------+
1 row in set (0.00 sec)
```

```mysql
mysql> SELECT NULLIF('mysql','mysql'),NULLIF('mysql', '');
+-------------------------+---------------------+
| NULLIF('mysql','mysql') | NULLIF('mysql', '') |
+-------------------------+---------------------+
| NULL                    | mysql               |
+-------------------------+---------------------+
1 row in set (0.00 sec)
```





## 4. 日期和时间函数

### 4.1 获取日期、时间

| 函数                                                         | 用法                           |
| ------------------------------------------------------------ | ------------------------------ |
| **CURDATE()** ，CURRENT_DATE()                               | 返回当前日期，只包含年、月、日 |
| **CURTIME()** ， CURRENT_TIME()                              | 返回当前时间，只包含时、分、秒 |
| **NOW()** / SYSDATE() / CURRENT_TIMESTAMP() / LOCALTIME() / LOCALTIMESTAMP() | 返回当前系统日期和时间         |
| UTC_DATE()                                                   | 返回UTC（世界标准时间）日期    |
| UTC_TIME()                                                   | 返回UTC（世界标准时间）时间    |



**年月日、时分秒、年月日时分秒**

~~~mysql
SELECT CURDATE(),CURRENT_DATE(),CURTIME(),NOW(),SYSDATE(),
UTC_DATE(),UTC_TIME()
FROM DUAL;
+------------+----------------+-----------+---------------------+---------------------+------------+------------+
| CURDATE()  | CURRENT_DATE() | CURTIME() | NOW()               | SYSDATE()           | UTC_DATE() | UTC_TIME() |
+------------+----------------+-----------+---------------------+---------------------+------------+------------+
| 2022-04-21 | 2022-04-21     | 13:33:23  | 2022-04-21 13:33:23 | 2022-04-21 13:33:23 | 2022-04-21 | 05:33:23   |
+------------+----------------+-----------+---------------------+---------------------+------------+------------+

SELECT CURDATE(),CURDATE() + 0,CURTIME() + 0,NOW() + 0
FROM DUAL;
+------------+---------------+---------------+----------------+
| CURDATE()  | CURDATE() + 0 | CURTIME() + 0 | NOW() + 0      |
+------------+---------------+---------------+----------------+
| 2022-04-21 |      20220421 |        133455 | 20220421133455 |
+------------+---------------+---------------+----------------+
~~~







### 4.2 日期与时间戳的转换（了解）

| 函数                     | 用法                                                         |
| ------------------------ | ------------------------------------------------------------ |
| UNIX_TIMESTAMP()         | 以UNIX时间戳的形式返回当前时间。SELECT UNIX_TIMESTAMP() ->1634348884 |
| UNIX_TIMESTAMP(date)     | 将时间date以UNIX时间戳的形式返回。                           |
| FROM_UNIXTIME(timestamp) | 将UNIX时间戳的时间转换为普通格式的时间                       |





日期与时间戳的转换

~~~mysql
SELECT UNIX_TIMESTAMP(),UNIX_TIMESTAMP('2021-10-01 12:12:32'),
FROM_UNIXTIME(1635173853),FROM_UNIXTIME(1633061552)
FROM DUAL;
+------------------+---------------------------------------+---------------------------+---------------------------+
| UNIX_TIMESTAMP() | UNIX_TIMESTAMP('2021-10-01 12:12:32') | FROM_UNIXTIME(1635173853) | FROM_UNIXTIME(1633061552) |
+------------------+---------------------------------------+---------------------------+---------------------------+
|       1650519378 |                            1633061552 | 2021-10-25 22:57:33       | 2021-10-01 12:12:32       |
+------------------+---------------------------------------+---------------------------+---------------------------+
~~~



举例：

```mysql
mysql> SELECT UNIX_TIMESTAMP(now());
+-----------------------+
| UNIX_TIMESTAMP(now()) |
+-----------------------+
|            1576380910 |
+-----------------------+
1 row in set (0.01 sec)

mysql> SELECT UNIX_TIMESTAMP(CURDATE());
+---------------------------+
| UNIX_TIMESTAMP(CURDATE()) |
+---------------------------+
|                1576339200 |
+---------------------------+
1 row in set (0.00 sec)

mysql> SELECT UNIX_TIMESTAMP(CURTIME());
+---------------------------+
| UNIX_TIMESTAMP(CURTIME()) |
+---------------------------+
|                1576380969 |
+---------------------------+
1 row in set (0.00 sec)

mysql> SELECT UNIX_TIMESTAMP('2011-11-11 11:11:11')
+---------------------------------------+
| UNIX_TIMESTAMP('2011-11-11 11:11:11') |
+---------------------------------------+
|                            1320981071 |
+---------------------------------------+
1 row in set (0.00 sec)
```

```mysql
mysql> SELECT FROM_UNIXTIME(1576380910);
+---------------------------+
| FROM_UNIXTIME(1576380910) |
+---------------------------+
| 2019-12-15 11:35:10       |
+---------------------------+
1 row in set (0.00 sec)
```





### 4.3 获取月份、星期、星期数、天数等函数（了解）

| 函数                                     | 用法                                            |
| ---------------------------------------- | ----------------------------------------------- |
| YEAR(date) / MONTH(date) / DAY(date)     | 返回具体的日期值                                |
| HOUR(time) / MINUTE(time) / SECOND(time) | 返回具体的时间值                                |
| MONTHNAME(date)                          | 返回月份：January，...                          |
| DAYNAME(date)                            | 返回星期几：MONDAY，TUESDAY.....SUNDAY          |
| WEEKDAY(date)                            | 返回周几，注意，周1是0，周2是1，。。。周日是6   |
| QUARTER(date)                            | 返回日期对应的季度，范围为1～4                  |
| WEEK(date) ， WEEKOFYEAR(date)           | 返回一年中的第几周                              |
| DAYOFYEAR(date)                          | 返回日期是一年中的第几天                        |
| DAYOFMONTH(date)                         | 返回日期位于所在月份的第几天                    |
| DAYOFWEEK(date)                          | 返回周几，注意：周日是1，周一是2，。。。周六是7 |



单取 年、月、日、时、分、秒

~~~mysql
SELECT YEAR(CURDATE()),MONTH(CURDATE()),DAY(CURDATE()),
HOUR(CURTIME()),MINUTE(NOW()),SECOND(SYSDATE())
FROM DUAL;
+-----------------+------------------+----------------+-----------------+---------------+-------------------+
| YEAR(CURDATE()) | MONTH(CURDATE()) | DAY(CURDATE()) | HOUR(CURTIME()) | MINUTE(NOW()) | SECOND(SYSDATE()) |
+-----------------+------------------+----------------+-----------------+---------------+-------------------+
|            2022 |                4 |             21 |              13 |            38 |                45 |
+-----------------+------------------+----------------+-----------------+---------------+-------------------+
~~~



~~~mysql
-- QUARTER(date)
# 存在隐式转换 将字符串 '2021-10-26'转为 日期
SELECT MONTHNAME('2021-10-26'),DAYNAME('2021-10-26'),WEEKDAY('2021-10-26'),
QUARTER(CURDATE()),WEEK(CURDATE()),DAYOFYEAR(NOW()),
DAYOFMONTH(NOW()),DAYOFWEEK(NOW())
FROM DUAL;

+-------------------------+-----------------------+-----------------------+--------------------+-----------------+
| MONTHNAME('2021-10-26') | DAYNAME('2021-10-26') | WEEKDAY('2021-10-26') | QUARTER(CURDATE()) | WEEK(CURDATE())
+-------------------------+-----------------------+-----------------------+--------------------+-----------------+
| October                 | Tuesday               |                     1 |                  2 |              16 |             
+-------------------------+-----------------------+-----------------------+--------------------+-----------------+

 | DAYOFYEAR(NOW()) | DAYOFMONTH(NOW()) | DAYOFWEEK(NOW()) |
 |        111       |                21 |                5 |
~~~





举例：

```mysql
SELECT YEAR(CURDATE()),MONTH(CURDATE()),DAY(CURDATE()),
HOUR(CURTIME()),MINUTE(NOW()),SECOND(SYSDATE())
FROM DUAL;
```

---

![image-20211025213504115](http://fgcy-pic.zhamao.ml/image-20211025213504115.png)

---



```mysql
SELECT MONTHNAME('2021-10-26'),DAYNAME('2021-10-26'),WEEKDAY('2021-10-26'),
QUARTER(CURDATE()),WEEK(CURDATE()),DAYOFYEAR(NOW()),
DAYOFMONTH(NOW()),DAYOFWEEK(NOW())
FROM DUAL;
```

----

![image-20211025214818623](http://fgcy-pic.zhamao.ml/image-20211025214818623.png)

----



### 4.4 日期的操作函数（了解）

| 函数                    | 用法                                       |
| ----------------------- | ------------------------------------------ |
| EXTRACT(type FROM date) | 返回指定日期中特定的部分，type指定返回的值 |

EXTRACT(type FROM date)函数中type的取值与含义：

---

![image-20211012142639469](http://fgcy-pic.zhamao.ml/image-20211012142639469.png)

![image-20211012142746444](http://fgcy-pic.zhamao.ml/image-20211012142746444.png)

----



```mysql
SELECT EXTRACT(MINUTE FROM NOW()) minutes,EXTRACT( WEEK FROM NOW()) week,
EXTRACT( QUARTER FROM NOW()) quarter,EXTRACT( MINUTE_SECOND FROM NOW()) second
FROM DUAL;

+---------+------+---------+--------+
| minutes | week | quarter | second |
+---------+------+---------+--------+
|      28 |   25 |       2 |   2830 |
+---------+------+---------+--------+
1 row in set (0.00 sec)
```



### 4.5 时间和秒钟转换的函数（了解）


| 函数                 | 用法                                                         |
| -------------------- | ------------------------------------------------------------ |
| TIME_TO_SEC(time)    | 将 time 转化为秒并返回结果值。转化的公式为：`小时*3600+分钟*60+秒` |
| SEC_TO_TIME(seconds) | 将 seconds 描述转化为包含小时、分钟和秒的时间                |

举例：

通过日期获取秒

```mysql
mysql> SELECT TIME_TO_SEC(NOW());
+--------------------+
| TIME_TO_SEC(NOW()) |
+--------------------+
|               78774 |
+--------------------+
1 row in set (0.00 sec)
```



通过秒转为时间

```mysql
mysql> SELECT SEC_TO_TIME(78774);
+--------------------+
| SEC_TO_TIME(78774) |
+--------------------+
| 21:52:54            |
+--------------------+
1 row in set (0.12 sec)
```





### 4.6 计算日期和时间的函数（了解）

**第1组：**

| 函数                                                         | 用法                                           |
| ------------------------------------------------------------ | ---------------------------------------------- |
| DATE_ADD(datetime, INTERVAL  expr type)，ADDDATE(date,INTERVAL expr type) | 返回与给定日期时间相差INTERVAL时间段的日期时间 |
| DATE_SUB(date,INTERVAL expr type)，SUBDATE(date,INTERVAL expr type) | 返回与date相差INTERVAL时间间隔的日期           |





上述函数中type的取值：

---

![image-20211012143203355](http://fgcy-pic.zhamao.ml/image-20211012143203355.png)

---



举例：

```mysql
SELECT DATE_ADD(NOW(), INTERVAL 1 DAY) AS col1,DATE_ADD('2021-10-21 23:32:12',INTERVAL 1 SECOND) AS col2,
ADDDATE('2021-10-21 23:32:12',INTERVAL 1 SECOND) AS col3,
DATE_ADD('2021-10-21 23:32:12',INTERVAL '1_1' MINUTE_SECOND) AS col4,
DATE_ADD(NOW(), INTERVAL -1 YEAR) AS col5, #可以是负数
DATE_ADD(NOW(), INTERVAL '1_1' YEAR_MONTH) AS col6 #需要单引号
FROM DUAL;
```

----

![image-20220623143109033](http://fgcy-pic.zhamao.ml/image-20220623143109033.png)

---





```mysql
SELECT DATE_SUB('2021-01-21',INTERVAL 31 DAY) AS col1,
SUBDATE('2021-01-21',INTERVAL 31 DAY) AS col2,
DATE_SUB('2021-01-21 02:01:01',INTERVAL '1 1' DAY_HOUR) AS col3
FROM DUAL;

+------------+------------+---------------------+
| col1       | col2       | col3                |
+------------+------------+---------------------+
| 2020-12-21 | 2020-12-21 | 2021-01-20 01:01:01 |
+------------+------------+---------------------+
1 row in set (0.00 sec)
```



**第2组：**

| 函数                         | 用法                                                         |
| ---------------------------- | ------------------------------------------------------------ |
| ADDTIME(time1,time2)         | 返回time1加上time2的时间。当time2为一个数字时，代表的是`秒`，可以为负数 |
| SUBTIME(time1,time2)         | 返回time1减去time2后的时间。当time2为一个数字时，代表的是`秒`，可以为负数 |
| DATEDIFF(date1,date2)        | 返回date1 - date2的日期间隔天数                              |
| TIMEDIFF(time1, time2)       | 返回time1 - time2的时间间隔                                  |
| FROM_DAYS(N)                 | 返回从0000年1月1日起，N天以后的日期                          |
| TO_DAYS(date)                | 返回日期date距离0000年1月1日的天数                           |
| LAST_DAY(date)               | 返回date所在月份的最后一天的日期                             |
| MAKEDATE(year,n)             | 针对给定年份与所在年份中的天数返回一个日期                   |
| MAKETIME(hour,minute,second) | 将给定的小时、分钟和秒组合成时间并返回                       |
| PERIOD_ADD(time,n)           | 返回time加上n后的时间                                        |

举例：

```mysql
SELECT ADDTIME(NOW(),20),SUBTIME(NOW(),30),SUBTIME(NOW(),'1:1:3'),DATEDIFF(NOW(),'2021-10-01'),
TIMEDIFF(NOW(),'2021-10-25 22:10:10'),FROM_DAYS(366),TO_DAYS('0000-12-25'),
LAST_DAY(NOW()),MAKEDATE(YEAR(NOW()),12),MAKETIME(10,21,23),PERIOD_ADD(20200101010101,10)
FROM DUAL;
```

```mysql
mysql> SELECT ADDTIME(NOW(), 50);
+---------------------+
| ADDTIME(NOW(), 50)  |
+---------------------+
| 2019-12-15 22:17:47 |
+---------------------+
1 row in set (0.00 sec)

mysql> SELECT ADDTIME(NOW(), '1:1:1');
+-------------------------+
| ADDTIME(NOW(), '1:1:1') |
+-------------------------+
| 2019-12-15 23:18:46     |
+-------------------------+
1 row in set (0.00 sec)
```

```mysql
mysql> SELECT SUBTIME(NOW(), '1:1:1');
+-------------------------+
| SUBTIME(NOW(), '1:1:1') |
+-------------------------+
| 2019-12-15 21:23:50     |
+-------------------------+
1 row in set (0.00 sec)

mysql> SELECT SUBTIME(NOW(), '-1:-1:-1'); 
+----------------------------+
| SUBTIME(NOW(), '-1:-1:-1') |
+----------------------------+
| 2019-12-15 22:25:11        |
+----------------------------+
1 row in set, 1 warning (0.00 sec)
```

```mysql
mysql> SELECT FROM_DAYS(366);
+----------------+
| FROM_DAYS(366) |
+----------------+
| 0001-01-01     |
+----------------+
1 row in set (0.00 sec)
```

```mysql
mysql> SELECT MAKEDATE(2020,1);
+------------------+
| MAKEDATE(2020,1) |
+------------------+
| 2020-01-01       |
+------------------+
1 row in set (0.00 sec)

mysql> SELECT MAKEDATE(2020,32);
+-------------------+
| MAKEDATE(2020,32) |
+-------------------+
| 2020-02-01        |
+-------------------+
1 row in set (0.00 sec)
```

```mysql
mysql> SELECT MAKETIME(1,1,1);
+-----------------+
| MAKETIME(1,1,1) |
+-----------------+
| 01:01:01        |
+-----------------+
1 row in set (0.00 sec)
```

```mysql
mysql> SELECT PERIOD_ADD(20200101010101,1);
+------------------------------+
| PERIOD_ADD(20200101010101,1) |
+------------------------------+
|               20200101010102 |
+------------------------------+
1 row in set (0.00 sec)
```

```mysql
mysql> SELECT TO_DAYS(NOW());
+----------------+
| TO_DAYS(NOW()) |
+----------------+
|          737773 |
+----------------+
1 row in set (0.00 sec)
```

举例：查询 7 天内的新增用户数有多少？

```mysql
SELECT COUNT(*) as num FROM new_user WHERE TO_DAYS(NOW())-TO_DAYS(regist_time)<=7
```



~~~MYSQL
SELECT NOW(),DATE_ADD(NOW(),INTERVAL 1 YEAR),
DATE_ADD(NOW(),INTERVAL -1 YEAR),
DATE_SUB(NOW(),INTERVAL 1 YEAR)
FROM DUAL;
+---------------------+---------------------------------+----------------------------------+---------------------------------+
| NOW()               | DATE_ADD(NOW(),INTERVAL 1 YEAR) | DATE_ADD(NOW(),INTERVAL -1 YEAR) | DATE_SUB(NOW(),INTERVAL 1 YEAR) |
+---------------------+---------------------------------+----------------------------------+---------------------------------+
| 2022-04-21 13:54:51 | 2023-04-21 13:54:51             | 2021-04-21 13:54:51              | 2021-04-21 13:54:51             |
+---------------------+---------------------------------+----------------------------------+---------------------------------+


SELECT DATE_ADD(NOW(), INTERVAL 1 DAY) AS col1,DATE_ADD('2021-10-21 23:32:12',INTERVAL 1 SECOND) AS col2,
ADDDATE('2021-10-21 23:32:12',INTERVAL 1 SECOND) AS col3,
DATE_ADD('2021-10-21 23:32:12',INTERVAL '1_1' MINUTE_SECOND) AS col4,
DATE_ADD(NOW(), INTERVAL -1 YEAR) AS col5, #可以是负数
DATE_ADD(NOW(), INTERVAL '1_1' YEAR_MONTH) AS col6 #需要单引号
FROM DUAL;
+---------------------+---------------------+---------------------+---------------------+---------------------+
| col1                | col2                | col3                | col4                | col5                |            
+---------------------+---------------------+---------------------+---------------------+---------------------+
| 2022-04-22 13:59:29 | 2021-10-21 23:32:13 | 2021-10-21 23:32:13 | 2021-10-21 23:33:13 | 2021-04-21 13:59:29 |
+---------------------+---------------------+---------------------+---------------------+---------------------+
+-----------------------+
|    col6              |
|  2023-05-21 13:59:29 |
+----------------------+


SELECT ADDTIME(NOW(),20),SUBTIME(NOW(),'1:1:3'),DATEDIFF(NOW(),'2021-10-01'),
TIMEDIFF(NOW(),'2021-10-25 22:10:10') from dual;
+---------------------+------------------------+------------------------------+---------------------------------------+
| ADDTIME(NOW(),20)   | SUBTIME(NOW(),'1:1:3') | DATEDIFF(NOW(),'2021-10-01') | TIMEDIFF(NOW(),'2021-10-25 22:10:10') |
+---------------------+------------------------+------------------------------+---------------------------------------+
| 2022-04-21 14:07:09 | 2022-04-21 13:05:46    |                          202 | 838:59:59                             |
+---------------------+------------------------+------------------------------+---------------------------------------+



select FROM_DAYS(366),TO_DAYS('0000-12-25'),
LAST_DAY(NOW()),MAKEDATE(YEAR(NOW()),32),MAKETIME(10,21,23),PERIOD_ADD(20200101010101,10)
FROM DUAL;
+----------------+-----------------------+-----------------+--------------------------+--------------------+
| FROM_DAYS(366) | TO_DAYS('0000-12-25') | LAST_DAY(NOW()) | MAKEDATE(YEAR(NOW()),32) | MAKETIME(10,21,23) | 
+----------------+-----------------------+-----------------+--------------------------+--------------------+
| 0001-01-01     |                   359 | 2022-04-30      | 2022-02-01               | 10:21:23           |  
+----------------------------------------------------------------------------------------------------------+
+------------------------------+
|PERIOD_ADD(20200101010101,10) |
|         869817111            |
+------------------------------+
~~~





### 4.7 日期的格式化与解析（了解）

| 函数                              | 用法                                       |
| --------------------------------- | ------------------------------------------ |
| DATE_FORMAT(date,fmt)             | 按照字符串fmt格式化日期date值              |
| TIME_FORMAT(time,fmt)             | 按照字符串fmt格式化时间time值              |
| GET_FORMAT(date_type,format_type) | 返回日期字符串的显示格式                   |
| STR_TO_DATE(str, fmt)             | 按照字符串fmt对str进行解析，解析为一个日期 |

上述`非GET_FORMAT`函数中fmt参数常用的格式符：

| 格式符 | 说明                                                        | 格式符 | 说明                                                        |
| ------ | ----------------------------------------------------------- | ------ | ----------------------------------------------------------- |
| %Y     | 4位数字表示年份                                             | %y     | 表示两位数字表示年份                                        |
| %M     | 月名表示月份（January,....）                                | %m     | 两位数字表示月份（01,02,03。。。）                          |
| %b     | 缩写的月名（Jan.，Feb.，....）                              | %c     | 数字表示月份（1,2,3,...）                                   |
| %D     | 英文后缀表示月中的天数（1st,2nd,3rd,...）                   | %d     | 两位数字表示月中的天数(01,02...)                            |
| %e     | 数字形式表示月中的天数（1,2,3,4,5.....）                    |        |                                                             |
| %H     | 两位数字表示小数，24小时制（01,02..）                       | %h和%I | 两位数字表示小时，12小时制（01,02..）                       |
| %k     | 数字形式的小时，24小时制(1,2,3)                             | %l     | 数字形式表示小时，12小时制（1,2,3,4....）                   |
| %i     | 两位数字表示分钟（00,01,02）                                | %S和%s | 两位数字表示秒(00,01,02...)                                 |
| %W     | 一周中的星期名称（Sunday...）                               | %a     | 一周中的星期缩写（Sun.，Mon.,Tues.，..）                    |
| %w     | 以数字表示周中的天数(0=Sunday,1=Monday....)                 |        |                                                             |
| %j     | 以3位数字表示年中的天数(001,002...)                         | %U     | 以数字表示年中的第几周，（1,2,3。。）其中Sunday为周中第一天 |
| %u     | 以数字表示年中的第几周，（1,2,3。。）其中Monday为周中第一天 |        |                                                             |
| %T     | 24小时制                                                    | %r     | 12小时制                                                    |
| %p     | AM或PM                                                      | %%     | 表示%                                                       |

GET_FORMAT函数中date_type和format_type参数取值如下：

---

![image-20211012145231321](http://fgcy-pic.zhamao.ml/image-20211012145231321.png)

---







~~~mysql
# 格式化：日期 ---> 字符串
# 解析：  字符串 ----> 日期

#此时我们谈的是日期的显式格式化和解析

#之前，我们接触过隐式的格式化或解析
SELECT *
FROM employees
WHERE hire_date = '1993-01-13';
~~~

- **显式格式化**

~~~mysql
SELECT DATE_FORMAT(CURDATE(),'%Y-%M-%D'),
DATE_FORMAT(NOW(),'%Y-%m-%d'),TIME_FORMAT(CURTIME(),'%h:%i:%S')
FROM DUAL;
+-----------------------------------+-------------------------------+-----------------------------------+
| DATE_FORMAT(CURDATE(),'%Y-%M-%D') | DATE_FORMAT(NOW(),'%Y-%m-%d') | TIME_FORMAT(CURTIME(),'%h:%i:%S') |
+-----------------------------------+-------------------------------+-----------------------------------+
| 2022-April-21st                   | 2022-04-21                    | 02:13:11                          |
+-----------------------------------+-------------------------------+-----------------------------------+

select DATE_FORMAT(NOW(),'%Y-%M-%D %h:%i:%S %W %w %T %r')
FROM DUAL;
+----------------------------------------------------------+
| DATE_FORMAT(NOW(),'%Y-%M-%D %h:%i:%S %W %w %T %r')       |
+----------------------------------------------------------+
| 2022-April-21st 02:13:46 Thursday 4 14:13:46 02:13:46 PM |
+----------------------------------------------------------+
~~~

- **格式化的逆过程【解析】**

~~~mysql
-- 将字符串转为时间日期
SELECT STR_TO_DATE('2021-October-25th 11:37:30 Monday 1','%Y-%M-%D %h:%i:%S %W %w')
FROM DUAL;
+------------------------------------------------------------------------------+
| STR_TO_DATE('2021-October-25th 11:37:30 Monday 1','%Y-%M-%D %h:%i:%S %W %w') |
+------------------------------------------------------------------------------+
| 2021-10-25 11:37:30                                                          |
+------------------------------------------------------------------------------+

SELECT GET_FORMAT(DATE,'USA')
FROM DUAL;
+------------------------+
| GET_FORMAT(DATE,'USA') |
+------------------------+
| %m.%d.%Y               |

+------------------------+
SELECT DATE_FORMAT(CURDATE(),GET_FORMAT(DATE,'USA'))
FROM DUAL;
~~~



举例：

```mysql
mysql> SELECT DATE_FORMAT(NOW(), '%H:%i:%s');
+--------------------------------+
| DATE_FORMAT(NOW(), '%H:%i:%s') |
+--------------------------------+
| 22:57:34                        |
+--------------------------------+
1 row in set (0.00 sec)
```

```mysql
SELECT STR_TO_DATE('09/01/2009','%m/%d/%Y')
FROM DUAL;

SELECT STR_TO_DATE('20140422154706','%Y%m%d%H%i%s')
FROM DUAL;

SELECT STR_TO_DATE('2014-04-22 15:47:06','%Y-%m-%d %H:%i:%s')
FROM DUAL;
```

```mysql
mysql> SELECT GET_FORMAT(DATE, 'USA');
+-------------------------+
| GET_FORMAT(DATE, 'USA') |
+-------------------------+
| %m.%d.%Y                |
+-------------------------+
1 row in set (0.00 sec)

SELECT DATE_FORMAT(NOW(),GET_FORMAT(DATE,'USA')),
FROM DUAL;
```

```mysql
mysql> SELECT STR_TO_DATE('2020-01-01 00:00:00','%Y-%m-%d'); 
+-----------------------------------------------+
| STR_TO_DATE('2020-01-01 00:00:00','%Y-%m-%d') |
+-----------------------------------------------+
| 2020-01-01                                    |
+-----------------------------------------------+
1 row in set, 1 warning (0.00 sec)
```





## 5. 流程控制函数

流程处理函数可以根据不同的条件，执行不同的处理流程，可以在SQL语句中实现不同的条件选择。MySQL中的流程处理函数主要包括IF()、IFNULL()和CASE()函数。

| 函数                                                         | 用法                                            |
| ------------------------------------------------------------ | ----------------------------------------------- |
| IF(value,value1,value2)                                      | 如果value的值为TRUE，返回value1，否则返回value2 |
| IFNULL(value1, value2)                                       | 如果value1不为NULL，返回value1，否则返回value2  |
| CASE WHEN 条件1 THEN 结果1 WHEN 条件2 THEN 结果2 .... [ELSE resultn] END | 相当于Java的if...else if...else...              |
| CASE  expr WHEN 常量值1 THEN 值1 WHEN 常量值1 THEN 值1 .... [ELSE 值n] END | 相当于Java的switch...case...                    |



> IF(flag,v1,v2)

```mysql
SELECT IF(1 > 0,'正确','错误');

+-------------------------+
| IF(1 > 0,'正确','错误') |
+-------------------------+
| 正确                    |
+-------------------------+
```



~~~mysql
SELECT last_name,salary,IF(salary >= 6000,'高工资','低工资') "details"
FROM employees;
+-------------+----------+-----------+
| last_name   | salary   | details   |
+-------------+----------+-----------+
| King        | 24000.00 | 高工资    |
| Kochhar     | 17000.00 | 高工资    |
+-----------------------------------+

-- 一年总工资
SELECT last_name,commission_pct,IF(commission_pct IS NOT NULL,commission_pct,0) "details",
salary * 12 * (1 + IF(commission_pct IS NOT NULL,commission_pct,0)) "annual_sal"
FROM employees;
+-------------+----------------+---------+------------+
| last_name   | commission_pct | details | annual_sal |
+-------------+----------------+---------+------------+
| King        |           NULL |    0.00 |  288000.00 |
| Kochhar     |           NULL |    0.00 |  204000.00 |
| De Haan     |           NULL |    0.00 |  204000.00 |
+-----------------------------------------------------+
~~~



> IFNULL(flagValue,value)

```mysql
-- 看做是IF(VALUE,VALUE1,VALUE2)的特殊情况
SELECT last_name,commission_pct,IFNULL(commission_pct,0) "details"
FROM employees;
+-------------+----------------+---------+
| last_name   | commission_pct | details |
+-------------+----------------+---------+
| King        |           NULL |    0.00 |
| Kochhar     |           NULL |    0.00 |
+----------------------------------------+
```







> CASE WHEN ... THEN ...WHEN ... THEN ... ELSE ... END

注意：

1、一定要有END作为结尾

2、可以在END后给 改字段取别名



**类似于java的if ... else if ... else if ... else**

```mysql

SELECT last_name,salary,CASE
				 WHEN salary >= 15000 THEN '白骨精' 
			     WHEN salary >= 10000 THEN '潜力股'
			     WHEN salary >= 8000 THEN '小屌丝'
			     ELSE '草根' 
			     END "details"
			     ,department_id
FROM employees;
+-------------+----------+-----------+---------------+
| last_name   | salary   | details   | department_id |
+-------------+----------+-----------+---------------+
| King        | 24000.00 | 白骨精    |            90 |
| Kochhar     | 17000.00 | 白骨精    |            90 |
| De Haan     | 17000.00 | 白骨精    |            90 |
| Hunold      |  9000.00 | 小屌丝    |            60 |
| Ernst       |  6000.00 | 草根      |            60 |
+-----------------------------------------------------+
```





**类似于switch**

```mysql
SELECT CASE  WHEN 1 THEN '未付款' 
								   WHEN 2 THEN '已付款' 
								   WHEN 3 THEN '已发货'  
								   WHEN 4 THEN '确认收货'  
								   ELSE '无效订单' END '订单情况';
+----------+
| 订单情况 |
+----------+
| 未付款   |
+----------+
```



**练习：查询部门号为 10,20, 30 的员工信息, 若部门号为 10, 则打印其工资的 1.1 倍, 20 号部门, 则打印其工资的 1.2 倍, 30 号部门打印其工资的 1.3 倍数**

~~~mysql
/*

练习2
查询部门号为 10,20, 30 的员工信息, 
若部门号为 10, 则打印其工资的 1.1 倍, 
20 号部门, 则打印其工资的 1.2 倍, 
30 号部门打印其工资的 1.3 倍数

*/
SELECT employee_id,last_name,department_id,salary,CASE department_id WHEN 10 THEN salary * 1.1
								     WHEN 20 THEN salary * 1.2
								     WHEN 30 THEN salary * 1.3
								     END "details"
FROM employees
WHERE department_id IN (10,20,30);
+-------------+------------+---------------+----------+----------+
| employee_id | last_name  | department_id | salary   | details  |
+-------------+------------+---------------+----------+----------+
|         200 | Whalen     |            10 |  4400.00 |  4840.00 |
|         201 | Hartstein  |            20 | 13000.00 | 15600.00 |
|         202 | Fay        |            20 |  6000.00 |  7200.00 |
|         114 | Raphaely   |            30 | 11000.00 | 14300.00 |
|         115 | Khoo       |            30 |  3100.00 |  4030.00 |
|         116 | Baida      |            30 |  2900.00 |  3770.00 |
|         117 | Tobias     |            30 |  2800.00 |  3640.00 |
|         118 | Himuro     |            30 |  2600.00 |  3380.00 |
|         119 | Colmenares |            30 |  2500.00 |  3250.00 |
+-------------+------------+---------------+----------+----------+
~~~



流程控制：

1、顺序

2、分支

3、循环



## 6. 加密与解密函数

加密与解密函数主要用于对数据库中的数据进行加密和解密处理，以防止数据被他人窃取。这些函数在保证数据库安全时非常有用。

| 函数                        | 用法                                                         |
| --------------------------- | ------------------------------------------------------------ |
| PASSWORD(str)               | 返回字符串str的加密版本，41位长的字符串。加密结果`不可逆`，常用于用户的密码加密 |
| MD5(str)                    | 返回字符串str的md5加密后的值，也是一种加密方式。若参数为NULL，则会返回NULL |
| SHA(str)                    | 从原明文密码str计算并返回加密后的密码字符串，当参数为NULL时，返回NULL。`SHA加密算法比MD5更加安全`。 |
| ENCODE(value,password_seed) | 返回使用password_seed作为加密密码加密value                   |
| DECODE(value,password_seed) | 返回使用password_seed作为加密密码解密value                   |

可以看到，ENCODE(value,password_seed)函数与DECODE(value,password_seed)函数互为反函数





~~~mysql
# PASSWORD()在mysql8.0中弃用。
SELECT MD5('mysql'),SHA('mysql'),MD5(MD5('mysql'))
FROM DUAL;
+----------------------------------+------------------------------------------+----------------------------------+
| MD5('mysql')                     | SHA('mysql')                             | MD5(MD5('mysql'))                |
+----------------------------------+------------------------------------------+----------------------------------+
| 81c3b080dad537de7e10e0987a4bf52e | f460c882a18c1304d88854e902e11b85d71e7e1b | 9b1c95c962f12d84f57c68e694274783 |
+----------------------------------+------------------------------------------+----------------------------------+


#ENCODE()、DECODE() 在mysql8.0中弃用。
 select encode('mysql',1) from dual;
+--------------------------------------+
| encode('mysql',1)                    |
+--------------------------------------+
| 0xA0107AF3A0                         |
+--------------------------------------+

 SELECT DECODE(ENCODE('mysql',1),1) FROM DUAL;
+----------------------------------------------------------+
| DECODE(ENCODE('mysql',1),1)                              |
+----------------------------------------------------------+
| 0x6D7973716C                                             |
+----------------------------------------------------------+
~~~



举例：

```mysql
mysql> SELECT PASSWORD('mysql'), PASSWORD(NULL);
+-------------------------------------------+----------------+
| PASSWORD('mysql')                         | PASSWORD(NULL) |
+-------------------------------------------+----------------+
| *E74858DB86EBA20BC33D0AECAE8A8108C56B17FA |                |
+-------------------------------------------+----------------+
1 row in set, 1 warning (0.00 sec)
```

```mysql
SELECT md5('123')
->202cb962ac59075b964b07152d234b70
```

```mysql
SELECT SHA('Tom123')
->c7c506980abc31cc390a2438c90861d0f1216d50
```

```mysql
mysql> SELECT ENCODE('mysql', 'mysql');
+--------------------------+
| ENCODE('mysql', 'mysql') |
+--------------------------+
| íg　¼　ìÉ                  |
+--------------------------+
1 row in set, 1 warning (0.01 sec)
```

```mysql
mysql> SELECT DECODE(ENCODE('mysql','mysql'),'mysql');
+-----------------------------------------+
| DECODE(ENCODE('mysql','mysql'),'mysql') |
+-----------------------------------------+
| mysql                                   |
+-----------------------------------------+
1 row in set, 2 warnings (0.00 sec)
```



## 7. MySQL信息函数

MySQL中内置了一些可以查询MySQL信息的函数，这些函数主要用于帮助数据库开发或运维人员更好地对数据库进行维护工作。

| 函数                                                  | 用法                                                     |
| ----------------------------------------------------- | -------------------------------------------------------- |
| VERSION()                                             | 返回当前MySQL的版本号                                    |
| CONNECTION_ID()                                       | 返回当前MySQL服务器的连接数                              |
| DATABASE()，SCHEMA()                                  | 返回MySQL命令行当前所在的数据库                          |
| USER()，CURRENT_USER()、SYSTEM_USER()，SESSION_USER() | 返回当前连接MySQL的用户名，返回结果格式为“主机名@用户名” |
| CHARSET(value)                                        | 返回字符串value自变量的字符集                            |
| COLLATION(value)                                      | 返回字符串value的比较规则                                |



~~~mysql
SELECT VERSION(),CONNECTION_ID(),DATABASE(),SCHEMA(),USER(),CURRENT_USER() 
 from dual;
+------------+-----------------+------------+-----------+----------------+----------------+
| VERSION()  | CONNECTION_ID() | DATABASE() | SCHEMA()  | USER()         | CURRENT_USER() |
+------------+-----------------+------------+-----------+----------------+----------------+
| 5.7.34-log |               2 | atguigudb  | atguigudb | root@localhost | root@localhost |
+------------+-----------------+------------+-----------+----------------+----------------+

select CHARSET('尚硅谷'),COLLATION('尚硅谷')
	FROM DUAL;
+----------------------+------------------------+
| CHARSET('尚硅谷')    | COLLATION('尚硅谷')    |
+----------------------+------------------------+
| utf8                 | utf8_general_ci        |
+----------------------+------------------------+
~~~



举例：

```mysql
mysql> SELECT DATABASE();
+------------+
| DATABASE() |
+------------+
| test       |
+------------+
1 row in set (0.00 sec)

mysql> SELECT DATABASE();
+------------+
| DATABASE() |
+------------+
| test       |
+------------+
1 row in set (0.00 sec)
```

```mysql
mysql> SELECT USER(), CURRENT_USER(), SYSTEM_USER(),SESSION_USER();
+----------------+----------------+----------------+----------------+
| USER()         | CURRENT_USER() | SYSTEM_USER()  | SESSION_USER() |
+----------------+----------------+----------------+----------------+
| root@localhost | root@localhost | root@localhost | root@localhost |
+----------------+----------------+----------------+----------------+

```

```mysql
mysql> SELECT CHARSET('ABC');
+----------------+
| CHARSET('ABC') |
+----------------+
| utf8mb4        |
+----------------+
1 row in set (0.00 sec)
```

```mysql
mysql> SELECT COLLATION('ABC');
+--------------------+
| COLLATION('ABC')   |
+--------------------+
| utf8mb4_general_ci |
+--------------------+
1 row in set (0.00 sec)
```





## 8. 其他函数

MySQL中有些函数无法对其进行具体的分类，但是这些函数在MySQL的开发和运维过程中也是不容忽视的。

| 函数                           | 用法                                                         |
| ------------------------------ | ------------------------------------------------------------ |
| FORMAT(value,n)                | 返回对数字value进行格式化后的结果数据。n表示`四舍五入`后保留到小数点后n位 |
| CONV(value,from,to)            | 将value的值进行不同进制之间的转换                            |
| INET_ATON(ipvalue)             | 将以点分隔的IP地址转化为一个数字                             |
| INET_NTOA(value)               | 将数字形式的IP地址转化为以点分隔的IP地址                     |
| BENCHMARK(n,expr)              | 将表达式expr重复执行n次。用于测试MySQL处理expr表达式所耗费的时间 |
| CONVERT(value USING char_code) | 将value所使用的字符编码修改为char_code                       |

举例：

```mysql
# 如果n的值小于或者等于0，则只保留整数部分
mysql> SELECT FORMAT(123.123, 2), FORMAT(123.523, 0), FORMAT(123.123, -2); 
+--------------------+--------------------+---------------------+
| FORMAT(123.123, 2) | FORMAT(123.523, 0) | FORMAT(123.123, -2) |
+--------------------+--------------------+---------------------+
| 123.12             | 124                | 123                 |
+--------------------+--------------------+---------------------+
1 row in set (0.00 sec)
```



```mysql
mysql> SELECT CONV(16, 10, 2), CONV(8888,10,16), CONV(NULL, 10, 2);
+-----------------+------------------+-------------------+
| CONV(16, 10, 2) | CONV(8888,10,16) | CONV(NULL, 10, 2) |
+-----------------+------------------+-------------------+
| 10000           | 22B8             | NULL              |
+-----------------+------------------+-------------------+
1 row in set (0.00 sec)
```



```mysql
mysql> SELECT INET_ATON('192.168.1.100');
+----------------------------+
| INET_ATON('192.168.1.100') |
+----------------------------+
|                 3232235876 |
+----------------------------+
1 row in set (0.00 sec)

# 以“192.168.1.100”为例，计算方式为192乘以256的3次方，加上168乘以256的2次方，加上1乘以256，再加上100。
```



```mysql
mysql> SELECT INET_NTOA(3232235876);
+-----------------------+
| INET_NTOA(3232235876) |
+-----------------------+
| 192.168.1.100         |
+-----------------------+
1 row in set (0.00 sec)
```



```mysql
mysql> SELECT BENCHMARK(1, MD5('mysql'));
+----------------------------+
| BENCHMARK(1, MD5('mysql')) |
+----------------------------+
|                          0 |
+----------------------------+
1 row in set (0.00 sec)

mysql> SELECT BENCHMARK(1000000, MD5('mysql')); 
+----------------------------------+
| BENCHMARK(1000000, MD5('mysql')) |
+----------------------------------+
|                                0 |
+----------------------------------+
1 row in set (0.20 sec)
```

```mysql
mysql> SELECT CHARSET('mysql'), CHARSET(CONVERT('mysql' USING 'utf8'));
+------------------+----------------------------------------+
| CHARSET('mysql') | CHARSET(CONVERT('mysql' USING 'utf8')) |
+------------------+----------------------------------------+
| utf8mb4          | utf8                                   |
+------------------+----------------------------------------+
1 row in set, 1 warning (0.00 sec)
```





# 单行函数的课后练习



## **显示系统时间(注：日期+时间)**

now()

~~~mysql
SELECT NOW(),SYSDATE(),CURRENT_TIMESTAMP(),LOCALTIME(),LOCALTIMESTAMP() #大家只需要掌握一个函数就可以了
FROM DUAL;
+---------------------+---------------------+---------------------+---------------------+---------------------+
| NOW()               | SYSDATE()           | CURRENT_TIMESTAMP() | LOCALTIME()         | LOCALTIMESTAMP()    |
+---------------------+---------------------+---------------------+---------------------+---------------------+
| 2022-04-21 14:44:04 | 2022-04-21 14:44:04 | 2022-04-21 14:44:04 | 2022-04-21 14:44:04 | 2022-04-21 14:44:04 |
+---------------------+---------------------+---------------------+---------------------+---------------------+
~~~





## **将员工的姓名按首字母排序，并写出姓名的长度（length）**

~~~mysql
SELECT last_name,LENGTH(last_name) "name_length"
FROM employees
#order by last_name asc;
ORDER BY name_length ASC;
+-------------+-------------+
| last_name   | name_length |
+-------------+-------------+
| Gee         |           3 |
| Seo         |           3 |
| Lee         |           3 |
| Fox         |           3 |
| Fay         |           3 |
| King        |           4 |
-----------------------------
~~~



## **查询员工id,last_name,salary，并作为一个列输出，别名为OUT_PUT**

~~~mysql
SELECT CONCAT(employee_id,',',last_name,',',salary) "OUT_PUT"
FROM employees;
+-------------------------+
| OUT_PUT                 |
+-------------------------+
| 100,King,24000.00       |
| 101,Kochhar,17000.00    |
| 102,De Haan,17000.00    |
+-------------------------+

 SELECT CONCAT_WS('-',employee_id,last_name,salary) "OUT_PUT" FROM employees;
+-------------------------+
| OUT_PUT                 |
+-------------------------+
| 100-King-24000.00       |
| 101-Kochhar-17000.00    |
| 102-De Haan-17000.00    |
+-------------------------+
~~~



## **查询公司各员工工作的年数、工作的天数，并按工作年数的降序排序**

~~~mysql
SELECT employee_id,DATEDIFF(CURDATE(),hire_date)/365 "worked_years",
DATEDIFF(CURDATE(),hire_date) "worked_days",
TO_DAYS(CURDATE()) - TO_DAYS(hire_date) "worked_days1"
FROM employees
ORDER BY worked_years DESC;
+-------------+--------------+-------------+--------------+
| employee_id | worked_years | worked_days | worked_days1 |
+-------------+--------------+-------------+--------------+
|         100 |      34.8685 |       12727 |        12727 |
|         200 |      34.6164 |       12635 |        12635 |
|         101 |      32.6027 |       11900 |        11900 |
|         103 |      32.3178 |       11796 |        11796 |
|         104 |      30.9397 |       11293 |        11293 |
|         102 |      29.2877 |       10690 |        10690 |
|         203 |      27.8904 |       10180 |        10180 |
|         204 |      27.8904 |       10180 |        10180 |
|         205 |      27.8904 |       10180 |        10180 |
|         206 |      27.8904 |       10180 |        10180 |
+---------------------------------------------------------+
~~~



## **查询员工姓名，hire_date , department_id，满足以下条件 雇用时间在1997年之后，department_id 为80 或 90 或110, commission_pct不为空**

~~~mysql
SELECT last_name,hire_date,department_id
FROM employees
WHERE department_id IN (80,90,110)
AND commission_pct IS NOT NULL
#and hire_date >= '1997-01-01';  #存在着隐式转换
#and  date_format(hire_date,'%Y-%m-%d') >= '1997-01-01';  # 显式转换操作，格式化：日期---> 字符串【比较字符串大小】
#and  date_format(hire_date,'%Y') >= '1997';   			  # 显式转换操作，格式化
AND hire_date >= STR_TO_DATE('1997-01-01','%Y-%m-%d');# 显式转换操作，解析：字符串 ----> 日期【比较日期大小】
+------------+------------+---------------+
| last_name  | hire_date  | department_id |
+------------+------------+---------------+
| Partners   | 1997-01-05 |            80 |
| Errazuriz  | 1997-03-10 |            80 |
| Cambrault  | 1999-10-15 |            80 |
| Zlotkey    | 2000-01-29 |            80 |
| Tucker     | 1997-01-30 |            80 |
| Bernstein  | 1997-03-24 |            80 |
| Hall       | 1997-08-20 |            80 |
+-----------------------------------------+
~~~



## **查询公司中入职超过10000天的员工姓名、入职时间**

~~~mysql
SELECT last_name,hire_date
FROM employees
WHERE DATEDIFF(CURDATE(),hire_date) >= 10000;
+-----------+------------+
| last_name | hire_date  |
+-----------+------------+
| King      | 1987-06-17 |
| Kochhar   | 1989-09-21 |
| De Haan   | 1993-01-13 |
| Higgins   | 1994-06-07 |
| Gietz     | 1994-06-07 |
+-----------+------------+
~~~



## **做一个查询，产生下面的结果**

~~~mysql
#<last_name> earns <salary> monthly but wants <salary*3> 

SELECT CONCAT(last_name,' earns ',TRUNCATE(salary,0), ' monthly but wants ',TRUNCATE(salary * 3,0)) "Dream Salary"
FROM employees;
+-----------------------------------------------+
| Dream Salary                                  |
+-----------------------------------------------+
| King earns 24000 monthly but wants 72000      |
| Kochhar earns 17000 monthly but wants 51000   |
| De Haan earns 17000 monthly but wants 51000   |
| Hunold earns 9000 monthly but wants 27000     |
| Ernst earns 6000 monthly but wants 18000      |
+-----------------------------------------------+
~~~



## **使用case-when，按照下面的条件**

~~~mysql
/*job                  grade
AD_PRES              	A
ST_MAN               	B
IT_PROG              	C
SA_REP               	D
ST_CLERK             	E

产生下面的结果:
*/

SELECT last_name "Last_name",job_id "Job_id",CASE job_id 
							 WHEN 'AD_PRES' THEN 'A'
							 WHEN 'ST_MAN' THEN 'B'
							 WHEN 'IT_PROG' THEN 'C'
							 WHEN 'SA_REP' THEN 'D'
							 WHEN 'ST_CLERK' THEN 'E'
							 END "Grade"
FROM employees;
+-------------+------------+-------+
| Last_name   | Job_id     | Grade |
+-------------+------------+-------+
| King        | AD_PRES    | A     |
| Kochhar     | AD_VP      | NULL  |
| De Haan     | AD_VP      | NULL  |
| Hunold      | IT_PROG    | C     |
| Ernst       | IT_PROG    | C     |
+----------------------------------+
~~~

~~~mysql
SELECT last_name "Last_name",job_id "Job_id",CASE job_id WHEN 'AD_PRES' THEN 'A'
							 WHEN 'ST_MAN' THEN 'B'
							 WHEN 'IT_PROG' THEN 'C'
							 WHEN 'SA_REP' THEN 'D'
							 WHEN 'ST_CLERK' THEN 'E'
							 ELSE "undefined" 
							 END "Grade"
FROM employees;
+-------------+------------+-----------+
| Last_name   | Job_id     | Grade     |
+-------------+------------+-----------+
| King        | AD_PRES    | A         |
| Kochhar     | AD_VP      | undefined |
| De Haan     | AD_VP      | undefined |
| Hunold      | IT_PROG    | C         |
| Ernst       | IT_PROG    | C         |
+--------------------------------------+
~~~



